#!/bin/bash

spinner() {
    local i sp n
    sp='/-\|'
    n=${#sp}
    printf ' '
    while sleep 0.1; do
        printf "%s\b" "${sp:i++%n:1}"
    done
}

solver='clingo telingo'
problem_folder='./HanoiTower/ ./Labyrinth/ ./Nomistery/ ./RicochetRobots/ ./Sokoban/ ./Visit-all/'

printf "Creating benchmark instances:"
spinner &

for s in $solver; do
    #echo "... $s ..."

    # remove folder if exists
    if [ -d ./${s}-benchmark-instances/ ]; then
        # the directory exists
        [ "$(ls -A ./${s}-benchmark-instances/)" ] && rm -rf ./${s}-benchmark-instances/
    fi
    
    # create new folder for benchmark instances
    mkdir ./${s}-benchmark-instances/

    for problem in $problem_folder; do
        # create benchmark files
        for file in `ls $problem`; do
            if [[ $file =~ ^[0-9]{3,4}.*\.asp$ ]];
            then 
                if [[ $s == "clingo" ]];
                then
                    # only test instances starting with 3-4 numbers are of interest
                    cat $problem$file ./incmode.lp ${problem}encoding.asp | sed '/^#show/ d' | sed '/^%/ d' > ./${s}-benchmark-instances/$file
                else
                    cat ${problem}$file ${problem}encoding-telingo.lp | sed '/^#show/ d' | sed '/^%/ d' > ./${s}-benchmark-instances/$file
                fi
            fi
        done
    done
done

kill "$!" # kill the spinner
printf 'Done.\n'